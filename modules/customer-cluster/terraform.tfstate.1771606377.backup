{"version":4,"terraform_version":"1.11.4","serial":6,"lineage":"080087c4-e6b3-5df2-7a08-a76ecb7d761d","outputs":{"customer_cluster_ip":{"value":"3.7.37.227","type":"string"},"kubeconfig_fetch_command":{"value":"scp -i ~/.ssh/id_ed25519 ubuntu@3.7.37.227:/home/ubuntu/kubeconfig.yaml ./kubeconfig-customer.yaml","type":"string"},"ssh_command":{"value":"ssh -i ~/.ssh/id_ed25519 ubuntu@3.7.37.227","type":"string"}},"resources":[{"mode":"data","type":"aws_ami","name":"ubuntu_arm64","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"allow_unsafe_filter":null,"architecture":"arm64","arn":"arn:aws:ec2:ap-south-1::image/ami-0d9ee65a2a86e323b","block_device_mappings":[{"device_name":"/dev/sda1","ebs":{"delete_on_termination":"true","encrypted":"false","iops":"0","snapshot_id":"snap-0309b2dc736fdf166","throughput":"0","volume_initialization_rate":"0","volume_size":"8","volume_type":"gp3"},"no_device":"","virtual_name":""},{"device_name":"/dev/sdb","ebs":{},"no_device":"","virtual_name":"ephemeral0"},{"device_name":"/dev/sdc","ebs":{},"no_device":"","virtual_name":"ephemeral1"}],"boot_mode":"uefi","creation_date":"2026-02-18T10:51:26.000Z","deprecation_time":"2028-02-18T10:51:26.000Z","description":"Canonical, Ubuntu, 24.04, arm64 noble image","ena_support":true,"executable_users":null,"filter":[{"name":"name","values":["ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-arm64-server-*"]},{"name":"virtualization-type","values":["hvm"]}],"hypervisor":"xen","id":"ami-0d9ee65a2a86e323b","image_id":"ami-0d9ee65a2a86e323b","image_location":"amazon/ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-arm64-server-20260218","image_owner_alias":"amazon","image_type":"machine","imds_support":"v2.0","include_deprecated":false,"kernel_id":"","last_launched_time":"","most_recent":true,"name":"ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-arm64-server-20260218","name_regex":null,"owner_id":"099720109477","owners":["099720109477"],"platform":"","platform_details":"Linux/UNIX","product_codes":[],"public":true,"ramdisk_id":"","region":"ap-south-1","root_device_name":"/dev/sda1","root_device_type":"ebs","root_snapshot_id":"snap-0309b2dc736fdf166","sriov_net_support":"simple","state":"available","state_reason":{"code":"UNSET","message":"UNSET"},"tags":{},"timeouts":null,"tpm_support":"","uefi_data":null,"usage_operation":"RunInstances","virtualization_type":"hvm"},"sensitive_attributes":[]}]},{"mode":"data","type":"aws_caller_identity","name":"current","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"account_id":"909742510020","arn":"arn:aws:iam::909742510020:user/n52h53","id":"909742510020","user_id":"AIDA5HUHBB7CM7JDSY3ZN"},"sensitive_attributes":[]}]},{"mode":"managed","type":"aws_ec2_tag","name":"subnet_discovery","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"subnet-ce4ffeb5,karpenter.sh/discovery","key":"karpenter.sh/discovery","region":"ap-south-1","resource_id":"subnet-ce4ffeb5","value":"clusterra-customer-compute"},"sensitive_attributes":[],"private":"bnVsbA=="}]},{"mode":"managed","type":"aws_iam_instance_profile","name":"k8s_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"arn":"arn:aws:iam::909742510020:instance-profile/clusterra-customer-compute-customer-k8s-profile","create_date":"2026-02-20T16:00:26Z","id":"clusterra-customer-compute-customer-k8s-profile","name":"clusterra-customer-compute-customer-k8s-profile","name_prefix":"","path":"/","role":"clusterra-customer-compute-customer-k8s-role","tags":{},"tags_all":{},"unique_id":"AIPA5HUHBB7CMLUS335PS"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.k8s_node"]}]},{"mode":"managed","type":"aws_iam_instance_profile","name":"karpenter_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"arn":"arn:aws:iam::909742510020:instance-profile/clusterra-customer-compute-karpenter-node-profile","create_date":"2026-02-20T16:00:26Z","id":"clusterra-customer-compute-karpenter-node-profile","name":"clusterra-customer-compute-karpenter-node-profile","name_prefix":"","path":"/","role":"clusterra-customer-compute-karpenter-node-role","tags":null,"tags_all":{},"unique_id":"AIPA5HUHBB7CGPSHXNG7P"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.karpenter_node"]}]},{"mode":"managed","type":"aws_iam_policy","name":"karpenter_controller","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"arn":"arn:aws:iam::909742510020:policy/clusterra-customer-compute-karpenter-controller","attachment_count":0,"delay_after_policy_creation_in_ms":null,"description":"Permissions for Karpenter Controller to provision EC2 locally","id":"arn:aws:iam::909742510020:policy/clusterra-customer-compute-karpenter-controller","name":"clusterra-customer-compute-karpenter-controller","name_prefix":"","path":"/","policy":"{\"Statement\":[{\"Action\":[\"ssm:GetParameter\",\"ec2:DescribeImages\",\"ec2:RunInstances\",\"ec2:DescribeSubnets\",\"ec2:DescribeSecurityGroups\",\"ec2:DescribeLaunchTemplates\",\"ec2:DescribeInstances\",\"ec2:DescribeInstanceTypes\",\"ec2:DescribeInstanceTypeOfferings\",\"ec2:DescribeAvailabilityZones\",\"ec2:DeleteLaunchTemplate\",\"ec2:CreateTags\",\"ec2:CreateLaunchTemplate\",\"ec2:CreateFleet\",\"ec2:TagResource\",\"ec2:TerminateInstances\",\"ec2:DescribeSpotPriceHistory\",\"pricing:GetProducts\"],\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":[\"iam:PassRole\",\"iam:GetInstanceProfile\",\"iam:CreateInstanceProfile\",\"iam:DeleteInstanceProfile\",\"iam:AddRoleToInstanceProfile\",\"iam:RemoveRoleFromInstanceProfile\",\"iam:TagInstanceProfile\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","policy_id":"ANPA5HUHBB7CE3QXAQZOC","tags":null,"tags_all":{}},"sensitive_attributes":[],"private":"bnVsbA=="}]},{"mode":"managed","type":"aws_iam_role","name":"k8s_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"arn":"arn:aws:iam::909742510020:role/clusterra-customer-compute-customer-k8s-role","assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","create_date":"2026-02-20T16:00:25Z","description":"","force_detach_policies":false,"id":"clusterra-customer-compute-customer-k8s-role","inline_policy":[],"managed_policy_arns":["arn:aws:iam::909742510020:policy/clusterra-customer-compute-karpenter-controller","arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore"],"max_session_duration":3600,"name":"clusterra-customer-compute-customer-k8s-role","name_prefix":"","path":"/","permissions_boundary":"","tags":{},"tags_all":{},"unique_id":"AROA5HUHBB7CMCSGS7INQ"},"sensitive_attributes":[],"private":"bnVsbA=="}]},{"mode":"managed","type":"aws_iam_role","name":"karpenter_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"arn":"arn:aws:iam::909742510020:role/clusterra-customer-compute-karpenter-node-role","assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","create_date":"2026-02-20T16:00:25Z","description":"","force_detach_policies":false,"id":"clusterra-customer-compute-karpenter-node-role","inline_policy":[],"managed_policy_arns":[],"max_session_duration":3600,"name":"clusterra-customer-compute-karpenter-node-role","name_prefix":"","path":"/","permissions_boundary":"","tags":null,"tags_all":{},"unique_id":"AROA5HUHBB7CANX3FVLY5"},"sensitive_attributes":[],"private":"bnVsbA=="}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"karpenter_controller","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-customer-k8s-role/arn:aws:iam::909742510020:policy/clusterra-customer-compute-karpenter-controller","policy_arn":"arn:aws:iam::909742510020:policy/clusterra-customer-compute-karpenter-controller","role":"clusterra-customer-compute-customer-k8s-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_policy.karpenter_controller","aws_iam_role.k8s_node"]}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"karpenter_node_ecr","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-karpenter-node-role/arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly","policy_arn":"arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly","role":"clusterra-customer-compute-karpenter-node-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.karpenter_node"]}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"karpenter_node_eks_cni","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-karpenter-node-role/arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy","policy_arn":"arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy","role":"clusterra-customer-compute-karpenter-node-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.karpenter_node"]}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"karpenter_node_eks_worker","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-karpenter-node-role/arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy","policy_arn":"arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy","role":"clusterra-customer-compute-karpenter-node-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.karpenter_node"]}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"karpenter_node_ssm","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-karpenter-node-role/arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore","policy_arn":"arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore","role":"clusterra-customer-compute-karpenter-node-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.karpenter_node"]}]},{"mode":"managed","type":"aws_iam_role_policy_attachment","name":"ssm_core","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":0,"attributes":{"id":"clusterra-customer-compute-customer-k8s-role/arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore","policy_arn":"arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore","role":"clusterra-customer-compute-customer-k8s-role"},"sensitive_attributes":[],"private":"bnVsbA==","dependencies":["aws_iam_role.k8s_node"]}]},{"mode":"managed","type":"aws_instance","name":"k8s_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":2,"attributes":{"ami":"ami-0d9ee65a2a86e323b","arn":"arn:aws:ec2:ap-south-1:909742510020:instance/i-07f0640bed85eb42e","associate_public_ip_address":true,"availability_zone":"ap-south-1c","capacity_reservation_specification":[{"capacity_reservation_preference":"open","capacity_reservation_target":[]}],"cpu_options":[{"amd_sev_snp":"","core_count":2,"nested_virtualization":"","threads_per_core":1}],"credit_specification":[{"cpu_credits":"unlimited"}],"disable_api_stop":false,"disable_api_termination":false,"ebs_block_device":[],"ebs_optimized":false,"enable_primary_ipv6":null,"enclave_options":[{"enabled":false}],"ephemeral_block_device":[],"force_destroy":false,"get_password_data":false,"hibernation":false,"host_id":"","host_resource_group_arn":null,"iam_instance_profile":"clusterra-customer-compute-customer-k8s-profile","id":"i-07f0640bed85eb42e","instance_initiated_shutdown_behavior":"stop","instance_lifecycle":"","instance_market_options":[],"instance_state":"running","instance_type":"t4g.small","ipv6_address_count":0,"ipv6_addresses":[],"key_name":"demo","launch_template":[],"maintenance_options":[{"auto_recovery":"default"}],"metadata_options":[{"http_endpoint":"enabled","http_protocol_ipv6":"disabled","http_put_response_hop_limit":2,"http_tokens":"required","instance_metadata_tags":"disabled"}],"monitoring":false,"network_interface":[],"outpost_arn":"","password_data":"","placement_group":"","placement_group_id":"","placement_partition_number":0,"primary_network_interface":[{"delete_on_termination":true,"network_interface_id":"eni-06c4953dc6fa83994"}],"primary_network_interface_id":"eni-06c4953dc6fa83994","private_dns":"ip-172-31-31-80.ap-south-1.compute.internal","private_dns_name_options":[{"enable_resource_name_dns_a_record":false,"enable_resource_name_dns_aaaa_record":false,"hostname_type":"ip-name"}],"private_ip":"172.31.31.80","public_dns":"ec2-3-7-37-227.ap-south-1.compute.amazonaws.com","public_ip":"3.7.37.227","region":"ap-south-1","root_block_device":[{"delete_on_termination":true,"device_name":"/dev/sda1","encrypted":false,"iops":3000,"kms_key_id":"","tags":null,"tags_all":{},"throughput":125,"volume_id":"vol-0eb33541fd67a3167","volume_size":20,"volume_type":"gp3"}],"secondary_network_interface":[],"secondary_private_ips":[],"security_groups":["clusterra-customer-compute-customer-k8s-sg"],"source_dest_check":true,"spot_instance_request_id":"","subnet_id":"subnet-ce4ffeb5","tags":{"Name":"clusterra-customer-compute-customer-k8s-node"},"tags_all":{"Name":"clusterra-customer-compute-customer-k8s-node"},"tenancy":"default","timeouts":null,"user_data":"#!/bin/bash\nexec \u003e \u003e(tee /var/log/user-data.log|logger -t user-data -s 2\u003e/dev/console) 2\u003e\u00261\nset -x\necho \"Starting User Data Script for Customer Local Cluster...\"\n\n# Inject SSH Key EARLY for Debugging\nmkdir -p /home/ubuntu/.ssh\necho \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDFHxtEbckKo1YGpgj/AbfKBttmTeJA+PcsFcoVNDTO5 nikhil@ai-server\" \u003e\u003e /home/ubuntu/.ssh/authorized_keys\nchown -R ubuntu:ubuntu /home/ubuntu/.ssh\nchmod 700 /home/ubuntu/.ssh\nchmod 600 /home/ubuntu/.ssh/authorized_keys\n\n# Wait for apt lock to clear then install deps\nsleep 30\napt-get update \u0026\u0026 apt-get install -y curl jq || (sleep 30 \u0026\u0026 apt-get update \u0026\u0026 apt-get install -y curl jq)\n\necho \"Starting K3s installation...\"\nPUBLIC_IP=$$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)\ncurl -sfL https://get.k3s.io | sh -s - server --tls-san $$PUBLIC_IP\n\nexport KUBECONFIG=/etc/rancher/k3s/k3s.yaml\nchmod 644 $$KUBECONFIG\ncp $$KUBECONFIG /home/ubuntu/kubeconfig.yaml\nchown ubuntu:ubuntu /home/ubuntu/kubeconfig.yaml\n\necho \"Waiting for K3s to be ready...\"\nfor i in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30; do\n  if KUBECONFIG=/etc/rancher/k3s/k3s.yaml kubectl get nodes 2\u003e/dev/null | grep -q \"Ready\"; then\n    echo \"K3s Node is ready!\"\n    break\n  fi\n  echo \"Waiting for K3s... attempt $$i\"\n  sleep 10\ndone\n\necho \"Installing Helm...\"\ncurl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n\necho \"Deploying Cert Manager (Prerequisite)...\"\nKUBECONFIG=/etc/rancher/k3s/k3s.yaml /usr/local/bin/helm repo add jetstack https://charts.jetstack.io --force-update\nKUBECONFIG=/etc/rancher/k3s/k3s.yaml /usr/local/bin/helm repo update\nKUBECONFIG=/etc/rancher/k3s/k3s.yaml /usr/local/bin/helm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --version v1.16.0 \\\n  --set crds.enabled=true\n\necho \"Customer Local Base K3s Installation Complete!\"\n","user_data_base64":null,"user_data_replace_on_change":false,"volume_tags":null,"vpc_security_group_ids":["sg-02a8039d1b0037963"]},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMCwicmVhZCI6OTAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMiJ9","dependencies":["aws_iam_instance_profile.k8s_node","aws_iam_role.k8s_node","aws_security_group.k8s_node","data.aws_ami.ubuntu_arm64"]}]},{"mode":"managed","type":"aws_security_group","name":"k8s_node","provider":"provider[\"registry.opentofu.org/hashicorp/aws\"]","instances":[{"schema_version":1,"attributes":{"arn":"arn:aws:ec2:ap-south-1:909742510020:security-group/sg-02a8039d1b0037963","description":"Security group for K3s local cluster","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"id":"sg-02a8039d1b0037963","ingress":[{"cidr_blocks":["0.0.0.0/0"],"description":"K8s API","from_port":6443,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":6443},{"cidr_blocks":["0.0.0.0/0"],"description":"SSH","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":[],"description":"Flannel VXLAN","from_port":8472,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"udp","security_groups":[],"self":true,"to_port":8472},{"cidr_blocks":[],"description":"Kubelet API","from_port":10250,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":true,"to_port":10250}],"name":"clusterra-customer-compute-customer-k8s-sg","name_prefix":"","owner_id":"909742510020","region":"ap-south-1","revoke_rules_on_delete":false,"tags":{"Name":"clusterra-customer-compute-customer-k8s-sg","karpenter.sh/discovery":"clusterra-customer-compute"},"tags_all":{"Name":"clusterra-customer-compute-customer-k8s-sg","karpenter.sh/discovery":"clusterra-customer-compute"},"timeouts":null,"vpc_id":"vpc-5f392937"},"sensitive_attributes":[],"private":"eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6OTAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="}]}],"check_results":null}
